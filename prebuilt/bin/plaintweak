#!/system/bin/sh
if [ -z $(getprop persist.sys.extstorage)]; then
	extsd='/sdcard'
else
	extsd=$(getprop persist.sys.extstorage)
fi

gov(){
	gov=$2
	if [ -z $gov ]; then
	sysrw
	echo "Cores 1/2 Governor selection:"
	echo
	governors=$(cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_governors | sed 's/ /\n/g' | sed '$d')
	# Load text file lines into a bash array & print as a menu.
	OLD_IFS=$IFS
	IFS=$'\n'
	let line_counter=0
	for line in $governors; do
		let line_counter=$(($line_counter+1))
		printf "${line_counter}) ${line}\n"
	done
	IFS=$OLD_IFS
	echo "Choose number selection[0 = default or 99 = exit]:"
	read input
	if [ "$input" == "99" ];then
	exit
	fi
	if [ "$input" -gt "$line_counter" ];then
	echo "Invalid selection: Aborting script"
	exit
	fi
	sed -i '/gov=/d' $extsd/plaintweak
	setprop persist.sys.gov ""
	if [ "$input" != "0" ];then
	gov=$(cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_governors | sed 's/ /\n/g' | sed '$d' | head -n $input | tail -n 1)
	echo 'gov='$gov >> $extsd/plaintweak
	setprop persist.sys.gov $gov
	fi
	else
	sed -i '/gov=/d' $extsd/plaintweak
	echo 'gov='$gov >> $extsd/plaintweak
	setprop persist.sys.gov $gov
	fi
	sysro
clear
}
gov2(){
	gov2=$2
	if [ -z $gov2 ]; then
	echo "Cores 3/4 Governor selection:"
	echo
	governors=$(cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_governors | sed 's/ /\n/g' | sed '$d')
	# Load text file lines into a bash array & print as a menu.
	OLD_IFS=$IFS
	IFS=$'\n'
	let line_counter=0
	for line in $governors; do
		let line_counter=$(($line_counter+1))
		printf "${line_counter}) ${line}\n"
	done
	IFS=$OLD_IFS
	echo "Choose number selection[0 = default or 99 = exit]:"
	read input
	if [ "$input" == "99" ];then
	exit
	fi
	if [ "$input" -gt "$line_counter" ];then
	echo "Invalid selection: Aborting script"
	exit
	fi
	sed -i '/gov2=/d' /$extsd/plaintweak
	sed -i '/gov2=/d' /vendor/build.prop
	if [ "$input" != "0" ];then
	gov=$(cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_governors | sed 's/ /\n/g' | sed '$d' | head -n $input | tail -n 1)
	echo 'gov2='$gov >> /$extsd/plaintweak
	echo 'gov2='$gov >> /vendor/build.prop
	fi
	else
	sed -i '/gov2=/d' $extsd/plaintweak
	echo 'gov2='$gov2 >> $extsd/plaintweak
	setprop persist.sys.gov2 $gov2
	fi
clear
}
minkhz(){
	minkhz=$2
	if [ -z $minkhz]; then
	echo "Cores 1/2 Min CPU Clock selection:"
	echo
	frequencies=$(cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_frequencies | sed 's/ /\n/g' | sed '$d' | head -n 4)
	# Load text file lines into a bash array.
	OLD_IFS=$IFS
	IFS=$'\n'
	let line_counter=0
	for line in $frequencies; do
		let line_counter=$(($line_counter+1))
		printf "${line_counter}) ${line}\n"
	done
	IFS=$OLD_IFS
	echo "Choose number selection[0 = default or 99 = exit]:"
	read input
	if [ "$input" == "99" ];then
	exit
	fi
	if [ "$input" -gt "$line_counter" ];then
	echo "Invalid selection: Aborting script"
	exit
	fi
	sed -i '/minkhz=/d' $extsd/plaintweak
	setprop persist.sys.minkhz ""
	if [ "$input" != "0" ];then
	minkhz=$(cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_frequencies | sed 's/ /\n/g' | sed '$d' | head -n 4 | head -n $input | tail -n 1)
	echo 'minkhz='$minkhz >> /$extsd/plaintweak
	echo 'minkhz='$minkhz >> /vendor/build.prop
	fi
	else
	sed -i '/minkhz=/d' $extsd/plaintweak
	echo 'minkhz='$minkhz >> $extsd/plaintweak
	setprop persist.sys.minkhz $minkhz
	fi
clear
}
minkhz2(){
	minkhz2=$2
	if [ -z $minkhz2 ]; then
	echo "Cores 3/4 Min CPU Clock selection:"
	echo
	frequencies=$(cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_frequencies | sed 's/ /\n/g' | sed '$d' | head -n 4)
	# Load text file lines into a bash array.
	OLD_IFS=$IFS
	IFS=$'\n'
	let line_counter=0
	for line in $frequencies; do
		let line_counter=$(($line_counter+1))
		printf "${line_counter}) ${line}\n"
	done
	IFS=$OLD_IFS
	echo "Choose number selection[0 = default or 99 = exit]:"
	read input
	if [ "$input" == "99" ];then
	exit
	fi
	if [ "$input" -gt "$line_counter" ];then
	echo "Invalid selection: Aborting script"
	exit
	fi
	sed -i '/minkhz2=/d' $extsd/plaintweak
	setprop persist.sys.minkhz2 ""
	if [ "$input" != "0" ];then
	minkhz=$(cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_frequencies | sed 's/ /\n/g' | sed '$d' | head -n 4 | head -n $input | tail -n 1)
	echo 'minkhz2='$minkhz2 >> $extsd/plaintweak
	setprop persist.sys.minkhz2 $minkhz2
	fi
	else
	sed -i '/maxkhz2=/d' $extsd/plaintweak
	echo 'maxkhz2='$maxkhz2 >> $extsd/plaintweak
	setprop persist.sys.maxkhz2 $maxkhz2
	fi
clear
}
maxkhz(){
	maxkhz=$2
	if [ -z $maxkhz ]; then
	sysrw
	echo "Cores 1/2 Max CPU Clock selection:"
	echo
	frequencies=$(cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_frequencies | sed 's/ /\n/g' | sed '$d' | tail -n 5)
	# Load text file lines into a bash array.
	OLD_IFS=$IFS
	IFS=$'\n'
	let line_counter=0
	for line in $frequencies; do
		let line_counter=$(($line_counter+1))
		printf "${line_counter}) ${line}\n"
	done
	IFS=$OLD_IFS
	echo "Choose number selection[0 = default or 99 = exit]:"
	read input
	if [ "$input" == "99" ];then
	exit
	fi
	if [ "$input" -gt "$line_counter" ];then
	echo "Invalid selection: Aborting script"
	exit
	fi
	sed -i '/maxkhz=/d' $extsd/plaintweak
	setprop persist.sys.maxkhz ""
	if [ "$input" != "0" ];then
	maxkhz=$(cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_frequencies | sed 's/ /\n/g' | sed '$d' | tail -n 5 | head -n $input | tail -n 1)
	echo 'maxkhz='$maxkhz >> $extsd/plaintweak
	setprop persist.sys.maxkhz $maxkhz
	fi
	else
	sed -i '/maxkhz=/d' $extsd/plaintweak
	echo 'maxkhz='$maxkhz >> $extsd/plaintweak
	setprop persist.sys.maxkhz $maxkhz
	fi
	sysro
clear
}
maxkhz2(){
	maxkhz2=$2
	if [ -z $maxkhz2 ]; then
	sysrw
	echo "Cores 3/4 Max CPU Clock selection:"
	echo
	frequencies=$(cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_frequencies | sed 's/ /\n/g' | sed '$d' | tail -n 5)
	# Load text file lines into a bash array.
	OLD_IFS=$IFS
	IFS=$'\n'
	let line_counter=0
	for line in $frequencies; do
		let line_counter=$(($line_counter+1))
		printf "${line_counter}) ${line}\n"
	done
	IFS=$OLD_IFS
	echo "Choose number selection[0 = default or 99 = exit]:"
	read input
	if [ "$input" == "99" ];then
	exit
	fi
	if [ "$input" -gt "$line_counter" ];then
	echo "Invalid selection: Aborting script"
	exit
	fi
	sed -i '/maxkhz2=/d' $extsd/plaintweak
	setprop persist.sys.maxkhz2 ""
	if [ "$input" != "0" ];then
	maxkhz=$(cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_frequencies | sed 's/ /\n/g' | sed '$d' | tail -n 5 | head -n $input | tail -n 1)
	echo 'maxkhz2='$maxkhz >> $extsd/plaintweak
	setprop persist.sys.maxkhz2 $maxkhz
	fi
	else
	sed -i '/maxkhz2=/d' $extsd/plaintweak
	echo 'maxkhz2='$maxkhz2 >> $extsd/plaintweak
	setprop persist.sys.maxkhz2 $maxkhz2
	fi
	sysro
clear
}
scheduler(){
	scheduler=$2
	if [ -z $scheduler ];then
	sysrw
	echo "IO Scheduler selection:"
	echo
	schedulers=$(cat /sys/block/mmcblk0/queue/scheduler | sed 's/[[]//g' | sed 's/[]]//g' | sed 's/ /\n/g' | sed '$d')
	# Load text file lines into a bash array.
	OLD_IFS=$IFS
	IFS=$'\n'
	let line_counter=0
	for line in $schedulers; do
		let line_counter=$(($line_counter+1))
		printf "${line_counter}) ${line}\n"
	done
	IFS=$OLD_IFS
	echo "Choose number selection[0 = default or 99 = exit]:"
	read input
	if [ "$input" == "99" ];then
	exit
	fi
	if [ "$input" -gt "$line_counter" ];then
	echo "Invalid selection: Aborting script"
	exit
	fi
	sed -i '/scheduler=/d' $extsd/plaintweak
	setprop persist.sys.scheduler ""
	if [ "$input" != "0" ];then
	scheduler=$(cat /sys/block/mmcblk0/queue/scheduler | sed 's/[[]//g' | sed 's/[]]//g' | sed 's/ /\n/g' | sed '$d' | sed 's/ //g' | head -n $input | tail -n 1)
	echo 'scheduler='$scheduler >> $extsd/plaintweak
	setprop persist.sys.scheduler $scheduler
	fi
	else
	sed -i '/scheduler=/d' $extsd/plaintweak
	echo 'scheduler='$scheduler >> $extsd/plaintweak
	setprop persist.sys.scheduler $scheduler
	fi
	sysro
	clear
}
tcpcong(){
	tcpcong=$1
	if [ -z $tcpcong ]; then
	sysrw
	echo "TCP Congestion Control selection:"
	echo
	tcpcong=$(cat /proc/sys/net/ipv4/tcp_available_congestion_control | sed 's/ /\n/g')
	# Load text file lines into a bash array.
	OLD_IFS=$IFS
	IFS=$'\n'
	let line_counter=0
	for line in $tcpcong; do
		let line_counter=$(($line_counter+1))
		printf "${line_counter}) ${line}\n"
	done
	IFS=$OLD_IFS
	echo "Choose number selection[0 = default or 99 = exit]:"
	read input
	if [ "$input" == "99" ];then
	exit
	fi
	if [ "$input" -gt "$line_counter" ];then
	echo "Invalid selection: Aborting script"
	exit
	fi
	sed -i '/tcpcong=/d' $extsd/plaintweak
	setprop persist.sys.tcpcong ""
	if [ "$input" != "0" ];then
	tcpcong=$(cat /proc/sys/net/ipv4/tcp_available_congestion_control | sed 's/ /\n/g' | head -n $input | tail -n 1)
	echo 'tcpcong='$tcpcong >> $extsd/plaintweak
	setprop persist.sys.tcpcong $tcpcong
	sysro
	fi
	sed -i '/tcpcong=/d' $extsd/plaintweak
	echo 'tcpcong='$tcpcong >> $extsd/plaintweak
	setprop persist.sys.tcpcong $tcpcong
	fi
}
kernelconfig() {
	if [ -e /sdcard/plaintweak ]; then
	DATE=$(date +"%m"-"%d"-"%y")
	mkdir -p /sdcard/plain-tweak/$DATE
	mv /sdcard/plaintweak /sdcard/plain-tweak/$DATE/plaintweak
	fi
	case "$configselection" in
		maxkhz)
			maxkhz
			;;
		maxkhz2)
			maxkhz2
			;;
		minkhz)
			minkhz
			;;
		minkhz2)
			minkhz2
			;;
		gov)
			gov
			;;
		gov2)
			gov2
			;;
		scheduler)
			scheduler
			;;
		tcpcong)
			tcpcong
			;;
		*)
			"Exiting: Invalid input"
			exit
			;;
	esac
}
backupbuildprop() {
	sysrw
	cp /system/build.prop /system/.build.prop-original
	sysro
}
restorebuildprop() {
	sysrw
	cp /system/.build.prop-original /system/build.prop
	sysro
}
restoreplaintweakconfig() {
	mkdir -p /system/vendor/overlay
	if [ -e /sdcard/plaintweak ]; then
	cat /sdcard/plaintweak > /system/vendor/build.prop
	fi
	if [ -e /sdcard/customdensity ]; then
	cat /sdcard/customdensity >> /system/vendor/build.prop
	fi
	echo 'enable_plaintweak=1' >> /system/vendor/build.prop
	chmod 0644 /system/vendor/build.prop
}
bootanim() {
	bootanim=$(grep "debug.sf.nobootanimation" /vendor/build.prop | sed 's/debug.sf.nobootanimation*.//')
	if [ -n $bootanim ]; then
	if [ "$bootanim" == "1" ]; then
	echo "Boot Animation is currently off"
	echo "Re-enabling Boot Animation"
	sed -i -e 's/debug\.sf\.nobootanimation=1//' /vendor/build.prop
	fi
	fi
	if [ -z $bootanim ]; then
	echo "Disabling Boot Animation"
	echo "debug.sf.nobootanimation=1" >> /vendor/build.prop
	fi
}
density() {
	case "$setdensity" in
		stock)
		rm /sdcard/customdensity
		if [ -e /tmp/recovery.log ]; then
		echo $setdensity" is density obtained from Aroma" >> /tmp/recovery.log
		else
		echo -n '\03 Build-Prop Tweaks\0 Set '$customdensity' as new custom density\0' > /dev/log/main
		fi
		if [ ! -e /tmp/recovery.log ]; then
		sysro
		fi
		;;
		*)
		echo 'customdensity='$setdensity > /sdcard/customdensity
		if [ -e /tmp/recovery.log ]; then
		echo $setdensity" is density obtained from Aroma" >> /tmp/recovery.log
		else
		echo -n '\03 Build-Prop Tweaks\0 Set '$customdensity' as new custom density\0' > /dev/log/main
		fi
		if [ ! -e /tmp/recovery.log ]; then
		sysro
		fi
		;;
	esac
}
toggle() {
	toggle=$(getprop enable_plaintweak)
	sed -i '/enable_plaintweak/d' /vendor/build.prop
	if [ "$toggle" == "0" ]; then
	echo "Enabling Plain-Tweak"
	setprop enable_plaintweak 1
	fi
	if [ "$toggle" == "1" ]; then
	echo "Disabling Plain-Tweak"
	setprop enable_plaintweak 0
	fi
	}
if [ ! -e /tmp/recovery.log ]; then
sysrw
fi
extsd='sdcard'
case "$1" in
  density)
    setdensity=$2
    density
  ;;
  bootanim)
    bootanim
  ;;
  backupbuildprop)
    backupbuildprop
  ;;
  restorebuildprop)
    restorebuildprop
  ;;
  kernelconfig)
	configselection=$2
	if [ -z "$configselection" ]; then
  maxkhz
	maxkhz2
	minkhz
	minkhz2
	gov
	gov2
	scheduler
	tcpcong
	else
	kernelconfig
	fi
  ;;
  restoreplaintweakconfig)
	restoreplaintweakconfig
  ;;
  toggle)
	toggle
  ;;
esac
